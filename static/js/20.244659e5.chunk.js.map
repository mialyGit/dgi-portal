{"version":3,"sources":["components/Administrateur/Privilege/add.js","utils/index.js","utils/privilege.js"],"names":["AddPrivilege","history","useHistory","useState","errors","setErrors","user_id","application_id","data","setData","loading","setLoading","undefined","error","setError","privileges","setPrivileges","loadPrivilege","input","cb","json","JSON","parse","localStorage","getItem","length","fetch","response","setItem","stringify","map","row","label","nom_privilege","value","id","target","name","filterOption","createFilter","ignoreAccents","customStyles","hasError","container","base","flex","control","styles","borderColor","handleInputChange","e","validateForm","priv","newErrors","onSubmit","preventDefault","formErrors","Object","keys","privilege_id","el","join","newData","PrivilegeApi","add","then","res","console","log","push","pathname","item","find","obj","state","catch","err","message","Header","Title","as","Body","md","Group","Row","className","Label","column","sm","size","loadOptions","nom","prenom","defaultOptions","placeholder","onChange","abrev_app","nom_app","isMulti","values","variant","disabled","animation","role","aria-hidden","to","type","user","token","axios","Axios","create","baseURL","API_SERVER","headers","Authorization","getAll","get","post","delete","update","put"],"mappings":"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","file":"static/js/20.244659e5.chunk.js","sourcesContent":["import React, { useState } from 'react';\r\nimport {Form, InputGroup, Row, Col, Card, Button, Spinner } from 'react-bootstrap';\r\nimport { Link, useHistory } from 'react-router-dom';\r\nimport { createFilter } from 'react-select';\r\nimport AsyncSelect from 'react-select/async';\r\nimport Aux from \"hoc/_Aux\";\r\nimport PrivilegeApi from 'utils/privilege';\r\n\r\nconst AddPrivilege = () => {\r\n    const history = useHistory();\r\n    const initialState = {\r\n        user_id : 0,\r\n        application_id : 0,\r\n    }\r\n\r\n    const [errors, setErrors] = useState({});\r\n    const [data, setData] = useState(initialState)\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState(undefined);\r\n    const [privileges, setPrivileges] = useState([])\r\n\r\n    const loadUser = (input,cb) => {\r\n        let json = JSON.parse(localStorage.getItem('users') || '[]')\r\n        cb(json.map( row => ({\r\n            label: `${row.nom} ${row.prenom}`, \r\n            value: row.id, \r\n            target : { name: 'user_id', value : row.id }\r\n        })))\r\n    }\r\n\r\n    const loadApp = (input,cb) => {\r\n        let json = JSON.parse(localStorage.getItem('apps') || '[]')\r\n        cb(json.map( row => ({\r\n            label: `${row.abrev_app} - ${row.nom_app}`, \r\n            value: row.id, \r\n            target : { name: 'application_id', value : row.id }\r\n        })))\r\n    }\r\n\r\n    const loadPrivilege = async(input,cb) => {\r\n        let json = JSON.parse(localStorage.getItem('privileges') || '[]')\r\n        if(json.length === 0){\r\n            let response = await fetch('http://localhost:8000/api/privileges')\r\n            json = await response.json()\r\n            localStorage.setItem('privileges',JSON.stringify(json))\r\n        }\r\n        cb(json.map( row => ({\r\n            label: `${row.nom_privilege}`, \r\n            value: row.id, \r\n            target : { name: 'privilege_id', value : row.id }\r\n        })))\r\n    }\r\n    \r\n    const filterOption = createFilter({ ignoreAccents: true })\r\n\r\n    const customStyles  = (hasError) => ({\r\n        container: base => ({\r\n            ...base,\r\n            flex: 1\r\n        }),\r\n        control: (styles) => ({\r\n            ...styles,\r\n            ...(errors[hasError] && { borderColor: 'red' }),\r\n          }),\r\n    })\r\n\r\n    const handleInputChange = (e) => {\r\n        const { name, value } = e.target;\r\n        setData({ ...data, [name]: value });\r\n        if(!!errors[name]){\r\n            setErrors({...errors, [name]:null})\r\n        }\r\n    };\r\n\r\n    const handleMultiInputChange = (values) => {\r\n        setPrivileges(values)\r\n        errors.privileges && setErrors({...errors, privileges:null})\r\n    };\r\n    \r\n    const save = (e) => {\r\n        e.preventDefault();\r\n        setError(undefined);\r\n        const formErrors = validateForm()\r\n        // console.log(formErrors);\r\n        setLoading(true);\r\n        if(Object.keys(formErrors).length > 0){\r\n            setLoading(false);\r\n            setErrors(formErrors)\r\n        } else {\r\n            const privilege_id = privileges.map(el => el.value).join(',');\r\n            const newData =  {...data}\r\n            newData.privilege_id = privilege_id\r\n\r\n            PrivilegeApi.add(newData).then((res)=>{\r\n                let json = JSON.parse(localStorage.getItem('users') || '[]')\r\n                console.log(json);\r\n                if(json.length === 0) { return history.push({pathname: '/users'}); }\r\n                else {\r\n                    let item = json.find(obj => obj.id === newData.user_id);\r\n                    console.log(\"ato\");\r\n                    return history.push({pathname: '/users/details', state:{item}});\r\n                }\r\n            }).catch((err)=>{\r\n                console.log(err);\r\n                if (err.response.data) {\r\n                    setError(err.response.data.message);\r\n                } else setError(\"Erreur survenue au serveur \\n Veuillez contacter l'administrateur.\");\r\n                setLoading(false);\r\n            })\r\n        }\r\n    }\r\n    \r\n    const validateForm = () => {\r\n        const {application_id, user_id} = data;\r\n        const priv = privileges\r\n        const newErrors = {}\r\n        if(!user_id || user_id === 0) newErrors.user_id = \"Veuillez entrer l'utilisateur\"\r\n        if(!application_id || application_id === 0) newErrors.application_id = \"Veuillez entrer l'application\"\r\n        if(priv.length === 0) newErrors.privileges = \"Veuillez entrer les privilèges assignés\"\r\n        return newErrors\r\n    }\r\n    return (\r\n        <Aux>\r\n            <Row>\r\n                <Col>\r\n                    <Form onSubmit={save}>\r\n                        <Card>\r\n                            <Card.Header>\r\n                                <Card.Title as=\"h5\"> Ajouter un privilege </Card.Title>\r\n                            </Card.Header>\r\n                            <Card.Body>\r\n                                {/* { JSON.stringify(privileges) } */}\r\n                                <Row>\r\n                                    <Col md={6}>\r\n                                        <Form.Group as={Row} className=\"mb-3\">\r\n                                            <Form.Label column sm={4}>Selectionner l'utilisateur</Form.Label>\r\n                                            <Col>\r\n                                                <InputGroup size=\"sm\">\r\n                                                    <AsyncSelect filterOption={filterOption} loadOptions={loadUser} defaultOptions placeholder=\"Selectionner l'utilisateur\"  styles={ customStyles('user_id') } onChange={handleInputChange} />\r\n                                                </InputGroup>\r\n                                                <small className=\"text-danger text-right\">{errors.user_id}</small>\r\n                                            </Col>\r\n                                        </Form.Group>\r\n                                    </Col>\r\n                                    <Col md={6} >\r\n                                        <Form.Group as={Row} className=\"mb-3\">\r\n                                            <Form.Label className=\"text-right\" column sm={4}>Selectionner l'application</Form.Label>\r\n                                            <Col>\r\n                                                <InputGroup size=\"sm\">\r\n                                                    <AsyncSelect filterOption={filterOption} loadOptions={loadApp} defaultOptions placeholder=\"Selectionner l'application\"  styles={ customStyles('application_id') } onChange={handleInputChange} />\r\n                                                </InputGroup>\r\n                                                <small className=\"text-danger text-right\">{errors.application_id}</small>\r\n                                            </Col>\r\n                                        </Form.Group>\r\n                                    </Col>\r\n                                </Row>\r\n                                <Form.Group as={Row} className=\"mb-3\">\r\n                                    <Form.Label column sm={2}>Assigner au privilège</Form.Label>\r\n                                    <Col>\r\n                                        <InputGroup size=\"sm\">\r\n                                            <AsyncSelect isMulti filterOption={filterOption} loadOptions={loadPrivilege} defaultOptions placeholder=\"Selectionner le privilège\"  styles={ customStyles('privileges') } onChange={handleMultiInputChange} />\r\n                                        </InputGroup>\r\n                                        <small className=\"text-danger text-right\">{errors.privileges}</small>\r\n                                    </Col>\r\n                                </Form.Group>\r\n                                {error && (\r\n                                <p className=\"text-danger form-text m-3\">{error}</p>\r\n                            )}\r\n\r\n                            {(loading && (\r\n                                <Button variant=\"primary\" className=\"pull-right mt-2\" disabled>\r\n                                    <Spinner as=\"span\" className=\"mr-2\" size=\"sm\" animation=\"border\" role=\"status\" aria-hidden=\"true\" />\r\n                                    Veuillez patientez ...\r\n                                </Button>\r\n                            )) || (\r\n                                <div className=\"pull-right mt-2\">\r\n                                    <Link to=\"/users\">\r\n                                        <Button variant=\"secondary\" size=\"sm\">\r\n                                            <i className=\"feather icon-x-circle\"></i>Annuler\r\n                                        </Button>\r\n                                    </Link>\r\n                                    <Button type=\"submit\" variant=\"primary\" size=\"sm\">\r\n                                        <i className=\"feather icon-save\"></i>Sauvegarder\r\n                                    </Button>\r\n                                </div>\r\n                            )}\r\n                            </Card.Body>\r\n                        </Card>\r\n                    </Form>\r\n                </Col>\r\n            </Row>\r\n        </Aux>\r\n    );\r\n}\r\n\r\nexport default AddPrivilege;","import Axios from \"axios\";\r\nimport { API_SERVER } from \"../config/constant\";\r\n// import swal from \"sweetalert2\";\r\n\r\nconst user = JSON.parse(localStorage.getItem(\"user\"));\r\nconst token = user !== null ? user.token : \"\";\r\nconst axios = Axios.create({\r\n  baseURL: `${API_SERVER}`,\r\n  headers: { \"Content-Type\": \"application/json\", Authorization: `Bearer ${token}` },\r\n});\r\n\r\n/*axios.interceptors.request.use(\r\n  (config) => {\r\n    // trigger 'loading=true' event here\r\n    // if (config.url !== `/sanctum/csrf-cookie`) {\r\n    swal.fire({\r\n      title: \"Veuillez patientez\",\r\n      imageUrl: `${API_SERVER}loading2.gif`,\r\n      imageWidth: 50,\r\n      imageHeight: 50,\r\n      imageAlt: \"Attendre\",\r\n      allowOutsideClick: false,\r\n      showConfirmButton: false,\r\n    });\r\n    // }\r\n    return config;\r\n  },\r\n  (error) => {\r\n    // trigger 'loading=false' event here\r\n    swal.close();\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\naxios.interceptors.response.use(\r\n  (response) => {\r\n    // trigger 'loading=false' event here\r\n    swal.close();\r\n    return response;\r\n  },\r\n  (error) => {\r\n    // trigger 'loading=false' event here\r\n    swal.close();\r\n    return Promise.reject(error);\r\n  }\r\n);*/\r\n\r\nexport default axios;\r\n","import axios from \"./index\";\r\n\r\nclass PrivilegeApi {\r\n  static getAll = () => {\r\n    return axios.get(`${base}`);\r\n  };\r\n\r\n  static get = (id) => {\r\n    return axios.get(`${base}/${id}`);\r\n  };\r\n\r\n  static add = (data) => {\r\n    return axios.post(`${base}`, data);\r\n  };\r\n\r\n  static delete = (id) => {\r\n    return axios.delete(`${base}/${id}`);\r\n  };\r\n\r\n  static update = (data,id) => {\r\n    return axios.put(`${base}/${id}`, data);\r\n  };\r\n}\r\nlet base = \"api/user_privilege_apps\";\r\n\r\nexport default PrivilegeApi;\r\n"],"sourceRoot":""}